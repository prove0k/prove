<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K1 å¿«æ¨‚å­¸è‹±èª A-H</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --scale-icon: 1;
            --scale-text: 1;
            --base-icon-size: 3rem; /* å°æ‡‰ text-5xl */
            --base-text-size: 1.25rem; /* å°æ‡‰ text-xl */
        }

        body {
            font-family: 'Zen Maru Gothic', 'Fredoka', sans-serif;
            background-color: #f0f9ff;
            background-image: radial-gradient(#dbeafe 2px, transparent 2px);
            background-size: 30px 30px;
            user-select: none; /* Prevent text selection during game */
        }

        /* Dynamic Sizing Classes */
        .dynamic-icon {
            font-size: calc(var(--base-icon-size) * var(--scale-icon)) !important;
            line-height: 1.2;
            transition: font-size 0.2s;
        }
        .dynamic-text {
            font-size: calc(var(--base-text-size) * var(--scale-text)) !important;
            line-height: 1.4;
            transition: font-size 0.2s;
        }

        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover:active {
            transform: scale(0.95);
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .item-icon {
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.1));
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Game Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.4s ease-in-out;
        }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .pop {
            animation: pop 0.3s ease-out;
        }
        .game-card {
            cursor: pointer;
            transition: all 0.2s;
        }
        .game-card.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
            transform: scale(1.05);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.3);
        }
        .game-card.matched {
            border-color: #22c55e;
            background-color: #dcfce7;
            opacity: 0.6;
            pointer-events: none;
            transform: scale(0.95);
        }
        .game-card.wrong {
            border-color: #ef4444;
            background-color: #fee2e2;
        }
        
        /* Toggle Switch */
        .mode-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        .mode-btn {
            background-color: white;
            color: #4b5563;
        }
        
        /* Fade in animation for filtering */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* Settings Modal */
        input[type=range] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #d1d5db;
            outline: none;
            -webkit-appearance: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="min-h-screen pb-20">

    <!-- Header / Navigation -->
    <header class="bg-white shadow-lg sticky top-0 z-50 border-b-4 border-yellow-400">
        <div class="max-w-5xl mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center space-x-3 cursor-pointer" onclick="location.reload()">
                    <span class="text-4xl">ğŸšŒ</span>
                    <h1 class="text-2xl md:text-3xl font-bold text-blue-600 tracking-wider">K1 å¿«æ¨‚å­¸è‹±èª</h1>
                </div>
                
                <div class="flex items-center gap-3">
                    <!-- Mode Switcher -->
                    <div class="flex bg-gray-100 p-1 rounded-full shadow-inner">
                        <button onclick="switchMode('learn')" id="btn-learn" class="mode-btn active px-4 md:px-6 py-2 rounded-full font-bold text-lg transition-all flex items-center gap-2">
                            <span>ğŸ“–</span> <span class="hidden md:inline">å­¸ç¿’</span>
                        </button>
                        <button onclick="switchMode('game')" id="btn-game" class="mode-btn px-4 md:px-6 py-2 rounded-full font-bold text-lg transition-all flex items-center gap-2">
                            <span>ğŸ®</span> <span class="hidden md:inline">éŠæˆ²</span>
                        </button>
                    </div>

                    <!-- Settings Button -->
                    <button onclick="toggleSettings()" class="bg-gray-100 hover:bg-gray-200 text-gray-600 p-3 rounded-full transition shadow-sm border-2 border-gray-200" title="è¨­å®šå¤§å°">
                        <span class="text-xl">âš™ï¸</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Navigation Bar (Only for Learn Mode) -->
        <div id="nav-bar-container" class="bg-yellow-100 py-2 overflow-x-auto transition-all duration-300">
            <div class="flex space-x-2 px-4 min-w-max justify-center md:justify-start items-center" id="nav-buttons">
                <!-- Nav buttons generated by JS -->
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-5xl mx-auto px-4 py-8">
        
        <!-- LEARN VIEW -->
        <div id="learn-view" class="space-y-8">
            <div id="card-container" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Cards generated by JS -->
            </div>
        </div>

        <!-- GAME VIEW (Hidden by default) -->
        <div id="game-view" class="hidden">
            <div class="text-center mb-8">
                <div class="inline-block bg-white px-8 py-4 rounded-3xl shadow-lg border-4 border-indigo-200">
                    <h2 class="text-2xl font-bold text-indigo-600 mb-2">é…å°å°éŠæˆ²</h2>
                    <p class="text-gray-500">é»é¸ä¸€å€‹è‹±æ–‡å–®å­—ï¼Œå†é»é¸å°æ‡‰çš„åœ–ç‰‡ï¼</p>
                    <div class="mt-4 flex justify-center gap-4 text-xl font-bold">
                        <div class="text-green-500">å¾—åˆ†: <span id="score">0</span></div>
                    </div>
                </div>
            </div>

            <div id="game-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-3xl mx-auto">
                <!-- Game cards will be injected here -->
            </div>

            <div id="game-over" class="hidden text-center mt-8">
                <div class="text-6xl mb-4 animate-bounce">ğŸ‰</div>
                <h3 class="text-3xl font-bold text-purple-600 mb-4">å¥½æ£’å–”ï¼å…¨éƒ¨ç­”å°äº†ï¼</h3>
                <button onclick="initGame()" class="bg-yellow-400 hover:bg-yellow-500 text-white text-xl px-8 py-4 rounded-full font-bold shadow-lg transition transform hover:scale-110 border-b-4 border-yellow-600 active:border-b-0 active:translate-y-1">
                    å†ä¾†ä¸€å±€ âœ
                </button>
            </div>
        </div>

    </main>

    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center px-4">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black bg-opacity-40 backdrop-blur-sm transition-opacity" onclick="toggleSettings()"></div>
        
        <!-- Content -->
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-sm p-6 relative transform transition-all scale-100 animate-[pop_0.3s_ease-out]">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-700 flex items-center gap-2">
                    <span>âš™ï¸</span> è¨­å®šé¡¯ç¤º
                </h2>
                <button onclick="toggleSettings()" class="text-gray-400 hover:text-gray-600 text-2xl font-bold">&times;</button>
            </div>

            <div class="space-y-6">
                <!-- Icon Size Control -->
                <div class="bg-blue-50 p-4 rounded-2xl">
                    <div class="flex justify-between mb-2">
                        <label class="font-bold text-blue-600">åœ–æ¡ˆå¤§å°</label>
                        <span class="text-xs bg-blue-200 text-blue-700 px-2 py-0.5 rounded-full">Icon Size</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="text-xl">ğŸ</span>
                        <input type="range" min="0.8" max="2.0" step="0.1" value="1" id="icon-slider" oninput="updateSize('icon', this.value)">
                        <span class="text-3xl">ğŸ</span>
                    </div>
                </div>

                <!-- Text Size Control -->
                <div class="bg-green-50 p-4 rounded-2xl">
                    <div class="flex justify-between mb-2">
                        <label class="font-bold text-green-600">æ–‡å­—å¤§å°</label>
                        <span class="text-xs bg-green-200 text-green-700 px-2 py-0.5 rounded-full">Text Size</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="text-sm font-bold text-gray-500">Aa</span>
                        <input type="range" min="0.8" max="2.0" step="0.1" value="1" id="text-slider" oninput="updateSize('text', this.value)">
                        <span class="text-2xl font-bold text-gray-500">Aa</span>
                    </div>
                </div>
            </div>

            <div class="mt-6 text-center">
                <button onclick="toggleSettings()" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-blue-600 transition transform active:scale-95 w-full">
                    å®Œæˆ
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-gray-500 py-8 text-sm">
        <p>K1 English Learning Material â€¢ Design for Kids</p>
    </footer>

    <script>
        const letters = [
            {
                letter: 'A',
                lower: 'a',
                color: 'bg-red-100 border-red-300 text-red-600',
                items: [
                    { word: 'apple', zh: 'è˜‹æœ', icon: 'ğŸ' },
                    { word: 'ant', zh: 'èèŸ»', icon: 'ğŸœ' },
                    { word: 'axe', zh: 'æ–§é ­', icon: 'ğŸª“' }
                ]
            },
            {
                letter: 'B',
                lower: 'b',
                color: 'bg-yellow-100 border-yellow-300 text-yellow-600',
                items: [
                    { word: 'boy', zh: 'ç”·å­©', icon: 'ğŸ‘¦' },
                    { word: 'banana', zh: 'é¦™è•‰', icon: 'ğŸŒ' },
                    { word: 'ball', zh: 'çƒ', icon: 'âš½' }
                ]
            },
            {
                letter: 'C',
                lower: 'c',
                color: 'bg-blue-100 border-blue-300 text-blue-600',
                items: [
                    { word: 'cake', zh: 'è›‹ç³•', icon: 'ğŸ°' },
                    { word: 'cat', zh: 'è²“', icon: 'ğŸ±' },
                    { word: 'car', zh: 'è»Š', icon: 'ğŸš—' }
                ]
            },
            {
                letter: 'D',
                lower: 'd',
                color: 'bg-green-100 border-green-300 text-green-600',
                items: [
                    { word: 'dog', zh: 'ç‹—', icon: 'ğŸ¶' },
                    { word: 'door', zh: 'é–€', icon: 'ğŸšª' },
                    { word: 'doll', zh: 'æ´‹å¨ƒå¨ƒ', icon: 'ğŸ§¸' }
                ]
            },
            {
                letter: 'E',
                lower: 'e',
                color: 'bg-purple-100 border-purple-300 text-purple-600',
                items: [
                    { word: 'egg', zh: 'è›‹', icon: 'ğŸ¥š' },
                    { word: 'elephant', zh: 'å¤§è±¡', icon: 'ğŸ˜' },
                    { word: 'ear', zh: 'è€³æœµ', icon: 'ğŸ‘‚' }
                ]
            },
            {
                letter: 'F',
                lower: 'f',
                color: 'bg-orange-100 border-orange-300 text-orange-600',
                items: [
                    { word: 'fish', zh: 'é­š', icon: 'ğŸŸ' },
                    { word: 'frog', zh: 'é’è›™', icon: 'ğŸ¸' },
                    { word: 'food', zh: 'é£Ÿç‰©', icon: 'ğŸ±' }
                ]
            },
            {
                letter: 'G',
                lower: 'g',
                color: 'bg-teal-100 border-teal-300 text-teal-600',
                items: [
                    { word: 'girl', zh: 'å¥³å­©', icon: 'ğŸ‘§' },
                    { word: 'goat', zh: 'å±±ç¾Š', icon: 'ğŸ' },
                    { word: 'grass', zh: 'è‰', icon: 'ğŸŒ¿' }
                ]
            },
            {
                letter: 'H',
                lower: 'h',
                color: 'bg-pink-100 border-pink-300 text-pink-600',
                items: [
                    { word: 'hand', zh: 'æ‰‹', icon: 'âœ‹' },
                    { word: 'head', zh: 'é ­', icon: 'ğŸ—£ï¸' },
                    { word: 'happy', zh: 'å¿«æ¨‚', icon: 'ğŸ˜„' }
                ]
            }
        ];

        // --- Common Functions ---

        function speak(text, rate = 0.8) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = rate;
            utterance.pitch = 1.1;
            const voices = window.speechSynthesis.getVoices();
            const enVoice = voices.find(v => v.lang.startsWith('en-US') && !v.name.includes('Google')) || voices.find(v => v.lang.startsWith('en'));
            if (enVoice) utterance.voice = enVoice;
            window.speechSynthesis.speak(utterance);
        }

        // --- Settings Logic ---
        function toggleSettings() {
            const modal = document.getElementById('settings-modal');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
            } else {
                modal.classList.add('hidden');
            }
        }

        function updateSize(type, value) {
            const root = document.documentElement;
            if (type === 'icon') {
                root.style.setProperty('--scale-icon', value);
            } else if (type === 'text') {
                root.style.setProperty('--scale-text', value);
            }
        }

        // --- Learning View Logic ---

        function renderLearnApp() {
            const container = document.getElementById('card-container');
            const nav = document.getElementById('nav-buttons');
            container.innerHTML = ''; // Clear previous
            nav.innerHTML = ''; // Clear previous
            
            // 1. Add "ALL" Button
            const allBtn = document.createElement('button');
            allBtn.className = `nav-btn w-12 h-10 rounded-full font-bold text-sm border-2 border-gray-300 bg-white hover:bg-gray-100 text-gray-600 flex-shrink-0 shadow-sm transition-all active:scale-95 ring-2 ring-blue-400 ring-offset-2 transform scale-110`; // Default active
            allBtn.innerText = 'ALL';
            allBtn.dataset.letter = 'ALL';
            allBtn.onclick = () => filterCards('ALL');
            nav.appendChild(allBtn);
            
            letters.forEach(data => {
                // Navigation Buttons
                const navBtn = document.createElement('button');
                navBtn.className = `nav-btn w-10 h-10 rounded-full font-bold text-lg border-2 ${data.color.replace('bg-', 'border-').replace('text-', 'text-')} bg-white hover:bg-gray-50 flex-shrink-0 shadow-sm transition-all active:scale-95`;
                navBtn.innerText = data.letter;
                navBtn.dataset.letter = data.letter;
                navBtn.onclick = () => filterCards(data.letter);
                nav.appendChild(navBtn);

                // Main Cards
                const card = document.createElement('div');
                card.id = `section-${data.letter}`;
                card.dataset.letter = data.letter;
                // Add 'letter-section' class for filtering
                card.className = `letter-section rounded-3xl border-4 ${data.color.replace('bg-', 'border-').split(' ')[1]} bg-white shadow-xl overflow-hidden fade-in`;

                // Card Header
                const header = document.createElement('div');
                header.className = `${data.color} p-4 text-center cursor-pointer transition hover:brightness-95`;
                header.onclick = () => speak(`${data.letter}, ${data.lower}, ${data.letter}`);
                header.innerHTML = `
                    <div class="text-6xl font-black tracking-widest drop-shadow-sm inline-block floating">
                        ${data.letter}${data.lower}
                    </div>
                    <div class="text-sm font-bold opacity-70 mt-1">é»æ“Šè½ç™¼éŸ³</div>
                `;
                card.appendChild(header);

                // Items Grid
                const grid = document.createElement('div');
                grid.className = "p-4 grid grid-cols-3 gap-4";

                data.items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = "flex flex-col items-center justify-center p-2 rounded-xl bg-gray-50 border-2 border-gray-100 card-hover cursor-pointer h-full";
                    itemDiv.onclick = () => speak(item.word);
                    
                    // Changed: Use dynamic-icon and dynamic-text classes instead of fixed tailwind sizes
                    itemDiv.innerHTML = `
                        <div class="mb-2 item-icon dynamic-icon">${item.icon}</div>
                        <div class="font-bold text-gray-700 capitalize select-none dynamic-text">${item.word}</div>
                        <div class="text-xs text-gray-400 font-medium">${item.zh}</div>
                    `;
                    grid.appendChild(itemDiv);
                });

                card.appendChild(grid);
                container.appendChild(card);
            });
        }

        function filterCards(filter) {
            const sections = document.querySelectorAll('.letter-section');
            const buttons = document.querySelectorAll('.nav-btn');

            // 1. Update Cards Visibility
            sections.forEach(sec => {
                if (filter === 'ALL' || sec.dataset.letter === filter) {
                    sec.classList.remove('hidden');
                    sec.classList.add('fade-in');
                } else {
                    sec.classList.add('hidden');
                    sec.classList.remove('fade-in');
                }
            });

            // 2. Update Buttons Active State
            buttons.forEach(btn => {
                if (btn.dataset.letter === filter) {
                    btn.classList.add('ring-2', 'ring-offset-2', 'ring-blue-400', 'scale-110');
                } else {
                    btn.classList.remove('ring-2', 'ring-offset-2', 'ring-blue-400', 'scale-110');
                }
            });
            
            if (filter !== 'ALL') {
                const letterData = letters.find(l => l.letter === filter);
                if (letterData) {
                    speak(`${letterData.letter}`);
                }
            }
        }

        // --- Game Logic ---

        let gameState = {
            selectedCard: null,
            matchesFound: 0,
            totalPairs: 4,
            isLocked: false
        };

        function getAllItems() {
            let allItems = [];
            letters.forEach(l => {
                l.items.forEach(item => {
                    allItems.push({...item, id: item.word}); 
                });
            });
            return allItems;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initGame() {
            const grid = document.getElementById('game-grid');
            const gameOverDiv = document.getElementById('game-over');
            grid.innerHTML = '';
            gameOverDiv.classList.add('hidden');
            
            gameState.selectedCard = null;
            gameState.matchesFound = 0;
            gameState.isLocked = false;
            document.getElementById('score').innerText = '0';

            // Pick 4 random distinct items
            const allItems = getAllItems();
            const shuffledItems = shuffle(allItems).slice(0, gameState.totalPairs);
            
            let gameCards = [];
            shuffledItems.forEach(item => {
                // Text Card - Apply dynamic-text class
                gameCards.push({
                    id: item.word,
                    type: 'text',
                    content: item.word,
                    display: `<span class="font-bold text-indigo-600 capitalize dynamic-text">${item.word}</span>`,
                    rawWord: item.word
                });
                // Icon Card - Apply dynamic-icon class
                gameCards.push({
                    id: item.word,
                    type: 'icon',
                    content: item.icon,
                    display: `<span class="item-icon dynamic-icon">${item.icon}</span>`,
                    rawWord: item.word
                });
            });

            shuffle(gameCards);

            gameCards.forEach(cardData => {
                const cardEl = document.createElement('div');
                // Removed fixed h-32/h-40 to allow dynamic sizing to expand the card if needed
                cardEl.className = 'game-card bg-white border-b-4 border-gray-200 rounded-2xl min-h-[8rem] p-2 flex items-center justify-center shadow-md active:scale-95 overflow-hidden';
                cardEl.dataset.id = cardData.id;
                cardEl.dataset.word = cardData.rawWord;
                cardEl.innerHTML = cardData.display;
                
                cardEl.onclick = () => handleCardClick(cardEl, cardData);
                grid.appendChild(cardEl);
            });
        }

        function handleCardClick(element, data) {
            if (gameState.isLocked) return;
            if (element.classList.contains('matched')) return;
            if (element === gameState.selectedCard) return;

            speak(data.rawWord);

            element.classList.add('selected');

            if (!gameState.selectedCard) {
                gameState.selectedCard = element;
            } else {
                gameState.isLocked = true;
                const prevElement = gameState.selectedCard;
                const prevId = prevElement.dataset.id;
                const currentId = data.id;

                if (prevId === currentId) {
                    setTimeout(() => {
                        element.classList.remove('selected');
                        prevElement.classList.remove('selected');
                        element.classList.add('matched', 'pop');
                        prevElement.classList.add('matched', 'pop');
                        
                        gameState.matchesFound++;
                        document.getElementById('score').innerText = gameState.matchesFound * 10;
                        gameState.selectedCard = null;
                        gameState.isLocked = false;

                        if (gameState.matchesFound === gameState.totalPairs) {
                            setTimeout(() => {
                                document.getElementById('game-over').classList.remove('hidden');
                                speak("Wonderful! You did it!");
                            }, 500);
                        }
                    }, 500);
                } else {
                    setTimeout(() => {
                        element.classList.add('wrong', 'shake');
                        prevElement.classList.add('wrong', 'shake');
                    }, 500);

                    setTimeout(() => {
                        element.classList.remove('selected', 'wrong', 'shake');
                        prevElement.classList.remove('selected', 'wrong', 'shake');
                        gameState.selectedCard = null;
                        gameState.isLocked = false;
                    }, 1200);
                }
            }
        }

        // --- UI Switching ---

        function switchMode(mode) {
            const learnView = document.getElementById('learn-view');
            const gameView = document.getElementById('game-view');
            const btnLearn = document.getElementById('btn-learn');
            const btnGame = document.getElementById('btn-game');
            const navBar = document.getElementById('nav-bar-container');

            if (mode === 'learn') {
                learnView.classList.remove('hidden');
                gameView.classList.add('hidden');
                btnLearn.classList.add('active');
                btnGame.classList.remove('active');
                navBar.style.height = 'auto';
                navBar.style.opacity = '1';
                navBar.classList.remove('hidden');
            } else {
                learnView.classList.add('hidden');
                gameView.classList.remove('hidden');
                btnLearn.classList.remove('active');
                btnGame.classList.add('active');
                navBar.style.height = '0';
                navBar.style.opacity = '0';
                setTimeout(() => navBar.classList.add('hidden'), 300);
                
                initGame();
            }
        }

        window.speechSynthesis.onvoiceschanged = () => {};
        renderLearnApp();

    </script>
</body>
</html>