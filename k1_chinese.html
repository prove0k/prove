<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K1 å¿«æ¨‚è­˜å­—å¡</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* é˜²æ­¢é»æ“Šæ™‚å‡ºç¾è—è‰²æ¡†æ¡† */
        button, div {
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }
        
        /* ç­”å°æ™‚çš„å‹•ç•« */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .animate-pop {
            animation: pop 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-4">

    <!-- Header & Mode Switch -->
    <div class="max-w-5xl mx-auto mb-6 pt-4">
        <div class="flex flex-col md:flex-row items-center justify-between gap-4">
            <!-- Title -->
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800 flex items-center gap-3">
                <span class="text-4xl md:text-5xl">ğŸ’</span> 
                K1 å¿«æ¨‚è­˜å­—å¡ 
            </h1>

            <!-- Mode Switch Buttons -->
            <div class="bg-white p-1 rounded-full shadow-sm border border-slate-200 flex">
                <button onclick="setMode('learn')" id="btn-learn" class="px-6 py-2 rounded-full text-lg font-bold transition-all flex items-center gap-2">
                    <i data-lucide="book-open" width="20"></i> å­¸ç¿’
                </button>
                <button onclick="setMode('game')" id="btn-game" class="px-6 py-2 rounded-full text-lg font-bold transition-all flex items-center gap-2">
                    <i data-lucide="gamepad-2" width="20"></i> éŠæˆ²
                </button>
            </div>
        </div>
    </div>

    <!-- Game Status Bar (Only visible in Game Mode) -->
    <div id="game-bar" class="hidden max-w-5xl mx-auto mb-6 bg-indigo-600 text-white rounded-2xl p-4 shadow-lg transform transition-all">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
                <button onclick="repeatQuestion()" class="bg-white/20 hover:bg-white/30 p-3 rounded-full transition-colors" title="å†è½ä¸€æ¬¡">
                    <i data-lucide="volume-2" width="28" height="28"></i>
                </button>
                <div>
                    <p class="text-indigo-200 text-sm">é¡Œç›®</p>
                    <p id="game-instruction" class="text-xl font-bold">è«‹æ‰¾å‡º...</p>
                </div>
            </div>
            <div class="flex items-center gap-2 bg-white/10 px-4 py-2 rounded-xl">
                <span class="text-2xl">â­ï¸</span>
                <span id="score-display" class="text-2xl font-bold">0</span>
            </div>
        </div>
    </div>

    <!-- Category Tabs -->
    <div id="category-container" class="max-w-5xl mx-auto mb-8 flex flex-wrap justify-center gap-3 transition-all duration-300">
        <!-- æŒ‰éˆ•å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
    </div>

    <!-- Cards Grid -->
    <div id="cards-container" class="max-w-5xl mx-auto grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 pb-20">
        <!-- å¡ç‰‡å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
    </div>

    <!-- Full Screen Feedback Overlay -->
    <div id="feedback-overlay" class="fixed inset-0 pointer-events-none flex items-center justify-center z-50 opacity-0 transition-opacity duration-300">
        <div class="bg-white/95 backdrop-blur-sm p-8 rounded-3xl shadow-2xl transform scale-0 transition-transform duration-300 text-center min-w-[300px] border-4 border-white/50" id="feedback-content">
            <div class="text-8xl mb-6" id="feedback-icon">ğŸ‰</div>
            <h2 class="text-4xl font-bold mb-2" id="feedback-title">å¥½æ£’ï¼</h2>
            <p class="text-2xl text-slate-500" id="feedback-subtitle"></p>
        </div>
    </div>

    <!-- Footer -->
    <div class="text-center text-slate-400 text-sm pb-8">
        è€å¸«å°æ’‡æ­¥ï¼šéŠæˆ²æ¨¡å¼ä¸‹ï¼Œç³»çµ±æœƒè‡ªå‹•å‡ºé¡Œï¼Œè«‹å°æœ‹å‹é»æ“Šæ­£ç¢ºçš„å¡ç‰‡ï¼
    </div>

    <script>
        // è©å½™è³‡æ–™åº«
        const vocabData = [
            // å­¸æ ¡èˆ‡ç¦®è²Œ
            { id: 1, word: "è€å¸«", emoji: "ğŸ‘©â€ğŸ«", category: "school", color: "bg-pink-100" },
            { id: 2, word: "ä¸Šå­¸", emoji: "ğŸ’", category: "school", color: "bg-pink-100" },
            { id: 3, word: "å†è¦‹", emoji: "ğŸ‘‹", category: "school", color: "bg-pink-100" },
            { id: 4, word: "è¬è¬", emoji: "ğŸ™", category: "school", color: "bg-pink-100" },
            
            // ç‰©å“
            { id: 5, word: "ç©å…·", emoji: "ğŸ§¸", category: "objects", color: "bg-yellow-100" },
            { id: 6, word: "è»Š", emoji: "ğŸš—", category: "objects", color: "bg-yellow-100" },

            // èº«é«”éƒ¨ä½
            { id: 7, word: "å£", emoji: "ğŸ‘„", category: "body", color: "bg-blue-100" },
            { id: 8, word: "æ‰‹", emoji: "ğŸ–ï¸", category: "body", color: "bg-blue-100" },
            { id: 9, word: "çœ¼", emoji: "ğŸ‘ï¸", category: "body", color: "bg-blue-100" },
            { id: 10, word: "é¼»", emoji: "ğŸ‘ƒ", category: "body", color: "bg-blue-100" },
            { id: 11, word: "è€³", emoji: "ğŸ‘‚", category: "body", color: "bg-blue-100" },
            { id: 12, word: "é ­", emoji: "ğŸ‘¦", category: "body", color: "bg-blue-100" },
            { id: 13, word: "è…³", emoji: "ğŸ¦¶", category: "body", color: "bg-blue-100" },

            // å®¶äºº
            { id: 14, word: "çˆ¸çˆ¸", emoji: "ğŸ‘¨", category: "family", color: "bg-green-100" },
            { id: 15, word: "åª½åª½", emoji: "ğŸ‘©", category: "family", color: "bg-green-100" },
            { id: 16, word: "å“¥å“¥", emoji: "ğŸ‘¦", category: "family", color: "bg-green-100" },
            { id: 17, word: "å§å§", emoji: "ğŸ‘§", category: "family", color: "bg-green-100" },
            { id: 18, word: "å¼Ÿå¼Ÿ", emoji: "ğŸ‘¶", category: "family", color: "bg-green-100" },
            { id: 19, word: "å¦¹å¦¹", emoji: "ğŸ§’", category: "family", color: "bg-green-100" },
        ];

        const categories = [
            { id: 'all', name: 'å…¨éƒ¨', icon: 'star' },
            { id: 'school', name: 'å­¸æ ¡ç¦®è²Œ', icon: 'sun' },
            { id: 'body', name: 'èº«é«”éƒ¨ä½', icon: 'smile' },
            { id: 'family', name: 'è¦ªæ„›å®¶äºº', icon: 'heart' },
            { id: 'objects', name: 'ç”Ÿæ´»ç‰©å“', icon: 'package' },
        ];

        // æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹
        let currentCategory = 'all';
        let isGameMode = false;
        let score = 0;
        let targetItem = null;
        let isProcessing = false; // é˜²æ­¢é‡è¤‡é»æ“Š

        // --- æ ¸å¿ƒåŠŸèƒ½ ---

        function setMode(mode) {
            isGameMode = (mode === 'game');
            
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            const btnLearn = document.getElementById('btn-learn');
            const btnGame = document.getElementById('btn-game');
            const activeClass = "bg-indigo-500 text-white shadow-md";
            const inactiveClass = "text-slate-500 hover:bg-slate-100";

            if (isGameMode) {
                btnLearn.className = btnLearn.className.replace(activeClass, inactiveClass).replace("bg-indigo-500 text-white shadow-md", "text-slate-500 hover:bg-slate-100");
                btnGame.className = "px-6 py-2 rounded-full text-lg font-bold transition-all flex items-center gap-2 " + activeClass;
                
                document.getElementById('game-bar').classList.remove('hidden');
                score = 0;
                updateScore();
                startNewRound();
            } else {
                btnGame.className = btnGame.className.replace(activeClass, inactiveClass).replace("bg-indigo-500 text-white shadow-md", "text-slate-500 hover:bg-slate-100");
                btnLearn.className = "px-6 py-2 rounded-full text-lg font-bold transition-all flex items-center gap-2 " + activeClass;
                
                document.getElementById('game-bar').classList.add('hidden');
                window.speechSynthesis.cancel(); // åœæ­¢ç™¼éŸ³
            }

            renderCards(); // é‡æ–°æ¸²æŸ“å¡ç‰‡ä»¥æ›´æ–°é»æ“Šäº‹ä»¶
        }

        function speak(text, callback) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'zh-HK';
            utterance.rate = 0.85; // å»£æ±è©±èªé€Ÿ
            if (callback) {
                utterance.onend = callback;
            }
            window.speechSynthesis.speak(utterance);
        }

        // --- éŠæˆ²é‚è¼¯ ---

        function getFilteredData() {
            return currentCategory === 'all' 
                ? vocabData 
                : vocabData.filter(item => item.category === currentCategory);
        }

        function startNewRound() {
            const items = getFilteredData();
            if (items.length === 0) return;

            // éš¨æ©Ÿé¸æ“‡ä¸€å€‹å–®å­—
            const randomIndex = Math.floor(Math.random() * items.length);
            targetItem = items[randomIndex];
            
            // æ›´æ–°æç¤ºæ–‡å­—
            document.getElementById('game-instruction').innerText = `è«‹æ‰¾å‡º...`;
            
            // å»¶é²ä¸€é»é»å†èªªè©±
            setTimeout(() => {
                repeatQuestion();
            }, 500);
        }

        function repeatQuestion() {
            if (!targetItem) return;
            speak(`è«‹æ‰¾å‡º ${targetItem.word}`);
        }

        function handleCardClick(item, cardElement) {
            if (isProcessing) return;

            if (!isGameMode) {
                // å­¸ç¿’æ¨¡å¼ï¼šç›´æ¥ç™¼éŸ³
                animateCard(cardElement, 'animate-pop');
                speak(item.word);
                return;
            }

            // éŠæˆ²æ¨¡å¼é‚è¼¯
            if (item.id === targetItem.id) {
                // --- ç­”å°äº† ---
                isProcessing = true;
                score++;
                updateScore();
                
                // è¨­å®šæˆåŠŸå½ˆçª—å…§å®¹
                const icon = document.getElementById('feedback-icon');
                const title = document.getElementById('feedback-title');
                const subtitle = document.getElementById('feedback-subtitle');
                
                icon.innerHTML = "ğŸ‰";
                title.innerHTML = "å¥½æ£’ï¼";
                title.className = "text-5xl font-bold mb-2 text-indigo-600";
                subtitle.innerHTML = ""; // æ¸…ç©ºå‰¯æ¨™é¡Œ

                showFeedback();
                
                speak("å¥½å»ï¼ç­”å•±å–‡ï¼", () => { 
                    setTimeout(() => {
                        hideFeedback();
                        startNewRound();
                        isProcessing = false;
                    }, 1000);
                });

            } else {
                // --- ç­”éŒ¯äº† ---
                isProcessing = true; // é–å®šï¼Œé¿å…é‡è¤‡é»æ“Š
                
                // è¨­å®šéŒ¯èª¤å½ˆçª—å…§å®¹
                const icon = document.getElementById('feedback-icon');
                const title = document.getElementById('feedback-title');
                const subtitle = document.getElementById('feedback-subtitle');
                
                // é¡¯ç¤ºé¸éŒ¯çš„é‚£å€‹å­—çš„åœ–æ¡ˆå’Œæ–‡å­—
                icon.innerHTML = item.emoji;
                title.innerHTML = "ä½ é¸éŒ¯äº†";
                title.className = "text-5xl font-bold mb-2 text-red-500"; // ç´…è‰²å­—é«”
                subtitle.innerHTML = `é€™æ˜¯ <b>${item.word}</b>`; // é¡¯ç¤ºé€™æ˜¯ä»€éº¼å­—

                showFeedback();

                // èªéŸ³æç¤ºï¼šä½ é¸éŒ¯äº†ï¼Œé€™æ˜¯ XX
                speak(`ä½ é¸éŒ¯äº†ï¼Œé€™æ˜¯ ${item.word}`, () => {
                    setTimeout(() => {
                        hideFeedback();
                        isProcessing = false; // è§£é–
                    }, 1500); // ç¨å¾®åœç•™ä¹…ä¸€é»è®“å°æœ‹å‹çœ‹æ¸…æ¥š
                });
            }
        }

        function updateScore() {
            document.getElementById('score-display').innerText = score;
        }

        function animateCard(element, animationClass) {
            element.classList.remove(animationClass);
            void element.offsetWidth; // è§¸ç™¼ reflow
            element.classList.add(animationClass);
        }

        // --- UI æ¸²æŸ“ ---

        function showFeedback() {
            const overlay = document.getElementById('feedback-overlay');
            const content = document.getElementById('feedback-content');
            
            overlay.classList.remove('opacity-0');
            content.classList.remove('scale-0');
            content.classList.add('scale-100');
        }

        function hideFeedback() {
            const overlay = document.getElementById('feedback-overlay');
            const content = document.getElementById('feedback-content');
            
            overlay.classList.add('opacity-0');
            content.classList.remove('scale-100');
            content.classList.add('scale-0');
        }

        function renderCategories() {
            const container = document.getElementById('category-container');
            container.innerHTML = '';

            categories.forEach(cat => {
                const btn = document.createElement('button');
                const isActive = currentCategory === cat.id;
                
                let classes = "flex items-center gap-2 px-4 py-2 rounded-full text-base font-bold transition-all transform hover:scale-105 shadow-sm border ";
                if (isActive) {
                    classes += "bg-indigo-100 text-indigo-700 border-indigo-200 shadow-indigo-100";
                } else {
                    classes += "bg-white text-slate-500 border-transparent hover:bg-indigo-50";
                }
                btn.className = classes;
                
                btn.innerHTML = `<i data-lucide="${cat.icon}" width="18" height="18"></i> ${cat.name}`;
                
                btn.onclick = () => {
                    currentCategory = cat.id;
                    renderCategories();
                    renderCards();
                    if (isGameMode) {
                        score = 0;
                        updateScore();
                        startNewRound(); // åˆ‡æ›åˆ†é¡æ™‚é‡æ–°å‡ºé¡Œ
                    }
                };

                container.appendChild(btn);
            });
            lucide.createIcons();
        }

        function renderCards() {
            const container = document.getElementById('cards-container');
            container.innerHTML = '';

            const items = getFilteredData();

            items.forEach(item => {
                const card = document.createElement('div');
                
                // åŸºæœ¬æ¨£å¼
                let cardClasses = `
                    ${item.color} 
                    relative cursor-pointer rounded-3xl p-6 
                    flex flex-col items-center justify-center 
                    shadow-md transition-all duration-200 transform border-4 border-white
                    select-none
                `;

                if (!isGameMode) {
                    cardClasses += " hover:shadow-xl hover:-translate-y-2 group";
                } else {
                    cardClasses += " active:scale-95 hover:shadow-lg";
                }

                card.className = cardClasses;

                card.innerHTML = `
                    <!-- Sound Icon Hint (éš±è—æ–¼éŠæˆ²æ¨¡å¼ä»¥æ¸›å°‘å¹²æ“¾) -->
                    ${!isGameMode ? `
                    <div class="absolute top-4 right-4 text-slate-400 group-hover:text-indigo-600 transition-colors">
                        <i data-lucide="volume-2" width="24" height="24"></i>
                    </div>` : ''}

                    <!-- Image/Emoji -->
                    <div class="text-7xl mb-4 filter drop-shadow-sm ${!isGameMode ? 'transform group-hover:scale-110 transition-transform duration-300' : ''}">
                        ${item.emoji}
                    </div>

                    <!-- Word -->
                    <h2 class="text-4xl font-black text-slate-800 mb-2 tracking-widest">
                        ${item.word}
                    </h2>
                `;

                card.onclick = () => handleCardClick(item, card);
                container.appendChild(card);
            });
            
            if (!isGameMode) lucide.createIcons();
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            setMode('learn'); // é è¨­ç‚ºå­¸ç¿’æ¨¡å¼
            renderCategories();
        };

    </script>
</body>
</html>