<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å»£æ±è©±è­˜å­—å°éŠæˆ²</title>
    <style>
        :root {
            --bg-color: #E0F2F1;
            --card-color: #FFFFFF;
            --primary-color: #26A69A;
            --text-color: #333;
            --font-main: 'Microsoft JhengHei', 'Noto Sans TC', sans-serif;
            --font-scale: 1; /* æ–°å¢è®Šæ•¸æ§åˆ¶å­—é«”å¤§å° */
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
        }

        h1 {
            color: #00695C;
            margin: 20px 0;
            text-align: center;
        }

        /* è¨­å®šæŒ‰éˆ• */
        .settings-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.6;
        }

        #settings-panel {
            display: none;
            background: white;
            padding: 15px;
            border-radius: 10px;
            position: absolute;
            top: 50px;
            right: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 100;
            width: 220px; /* è¨­å®šå¯¬åº¦è®“æ‹‰æ¡¿å¥½æ”¾ */
        }

        /* éŠæˆ²å€åŸŸ */
        #game-container {
            width: 90%;
            max-width: 600px;
            background: rgba(255,255,255,0.8);
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        /* é€²åº¦æ¢ */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #B2DFDB;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.5s;
        }

        /* é¡Œç›®å€ (å–‡å­) */
        .question-area {
            margin-bottom: 30px;
            text-align: center;
        }

        .speaker-btn {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #4DB6AC;
            color: white;
            border: none;
            font-size: 3rem;
            cursor: pointer;
            box-shadow: 0 5px 0 #00897B;
            transition: transform 0.1s, box-shadow 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .speaker-btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }
        
        .speaker-hint {
            margin-top: 10px;
            color: #666;
            font-size: 1.2rem;
        }

        /* é¸é …å€ (ç´”æ–‡å­—å¡ç‰‡) */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
        }

        .word-card {
            background: var(--card-color);
            border: 4px solid #eee;
            border-radius: 15px;
            height: 160px; /* ä¿®æ”¹ï¼šé«˜åº¦å¢åŠ  */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
            font-size: calc(3rem * var(--font-scale)); /* ä¿®æ”¹ï¼šä½¿ç”¨è®Šæ•¸æ§åˆ¶å¤§å° */
            font-weight: bold;
            color: #333;
            position: relative;
            overflow: hidden;
        }

        .word-card:hover {
            transform: scale(1.05);
            border-color: var(--primary-color);
            background: #E0F2F1;
        }

        .word-card:active {
            transform: scale(0.95);
        }

        /*å›é¥‹å‹•ç•«*/
        .correct {
            border-color: #66BB6A !important;
            background-color: #E8F5E9 !important;
            color: #2E7D32;
            animation: bounce 0.5s;
        }

        .wrong {
            border-color: #EF5350 !important;
            background-color: #FFEBEE !important;
            color: #C62828;
            animation: shake 0.5s;
        }

        /* é€šé—œç•«é¢ */
        .result-screen {
            text-align: center;
            display: none;
        }

        .restart-btn {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 1.5rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 0 #00796B;
        }

        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }

    </style>
</head>
<body>

    <h1>ğŸ‘‚ è½éŸ³è¾¨å­— (å»£æ±è©±)</h1>
    
    <button class="settings-btn" onclick="toggleSettings()">âš™ï¸</button>
    <div id="settings-panel">
        <label>å­—é«”å¤§å° (Text Size):</label><br>
        <input type="range" min="0.6" max="1.6" step="0.1" value="1" oninput="updateFontScale(this.value)" style="width: 100%; margin-bottom: 15px;">
        
        <label>èªéŸ³æ¸¬è©¦ (è«‹ç¢ºèªè½åˆ°å»£æ±è©±):</label><br>
        <button onclick="speak('ä½ å¥½', true)" style="margin-top:5px;">ğŸ”Š æ¸¬è©¦ç™¼éŸ³</button>
    </div>

    <div id="game-container">
        
        <!-- é€²åº¦ -->
        <div style="width:100%; display:flex; justify-content:space-between; margin-bottom:5px; color:#666;">
            <span>é¡Œç›®</span>
            <span id="score-text">1 / 10</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <!-- éŠæˆ²ä¸­ç•«é¢ -->
        <div id="game-play-area">
            <div class="question-area">
                <button class="speaker-btn" onclick="playCurrentQuestion()">ğŸ”Š</button>
                <div class="speaker-hint">é»æ“Šå–‡å­è½é¡Œç›®</div>
            </div>

            <div class="options-grid" id="options-area">
                <!-- é¸é …å‹•æ…‹ç”Ÿæˆ -->
            </div>
            
            <div id="feedback-text" style="height: 30px; text-align: center; margin-top: 15px; font-weight: bold; font-size: 1.2rem; color: #FF7043;"></div>
        </div>

        <!-- çµç®—ç•«é¢ -->
        <div id="result-area" class="result-screen">
            <div style="font-size: 5rem;">ğŸ‰</div>
            <h2>å¤ªæ£’äº†ï¼ä½ å®Œæˆäº†ï¼</h2>
            <p>å°æœ‹å‹çœŸè°æ˜ï¼Œèªå¾—å¥½å¤šå­—ï¼</p>
            <button class="restart-btn" onclick="startGame()">å†ä¾†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        // å–®å­—åº« (ç´”æ–‡å­—)
        const wordList = [
            "è€å¸«", "ä¸Šå­¸", "å†è¦‹", "è¬è¬",
            "ç©å…·", "è»Š",
            "å£", "æ‰‹", "çœ¼", "é¼»", "é ­", "è…³", "è€³",
            "çˆ¸çˆ¸", "åª½åª½", "å“¥å“¥", "å¼Ÿå¼Ÿ", "å§å§", "å¦¹å¦¹"
        ];

        let currentRound = 0;
        let totalRounds = 10;
        let currentTarget = "";
        let isAnswering = true;
        const synth = window.speechSynthesis;
        
        // æ–°å¢ï¼šæ›´æ–°å­—é«”å¤§å°å‡½æ•¸
        function updateFontScale(val) {
            document.documentElement.style.setProperty('--font-scale', val);
        }

        // å˜—è©¦å°‹æ‰¾å»£æ±è©±èªéŸ³
        function getCantoneseVoice() {
            const voices = synth.getVoices();
            // å„ªå…ˆå°‹æ‰¾ HKï¼Œå…¶æ¬¡æ˜¯ TW (æœ‰äº›ç³»çµ±æœƒæ··ç”¨)ï¼Œå†æ¬¡æ˜¯ä»»ä½• zh é–‹é ­
            return voices.find(v => v.lang === 'zh-HK') || 
                   voices.find(v => v.lang === 'zh-TW') || 
                   null;
        }

        function speak(text, isTest = false) {
            synth.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            
            // å¼·åˆ¶è¨­å®šç‚ºç²µèªä»£ç¢¼ï¼Œç€è¦½å™¨æœƒç›¡åŠ›åŒ¹é…
            utterance.lang = 'zh-HK'; 
            
            const voice = getCantoneseVoice();
            if (voice) {
                utterance.voice = voice;
            }

            utterance.rate = 0.8; // ç¨å¾®æ…¢ä¸€é»
            synth.speak(utterance);
            
            if(isTest) {
                alert("ç™¼éŸ³æ¸¬è©¦ï¼š\nå¦‚æœè½åˆ°çš„æ˜¯æ™®é€šè©±ï¼Œè«‹æª¢æŸ¥æ‚¨çš„è£ç½®æ˜¯å¦å®‰è£äº†å»£æ±è©±(ç²µèª)èªéŸ³åŒ…ã€‚\n(iOS/Macé€šå¸¸å…§å»ºï¼ŒWindowså¯èƒ½éœ€è¦è¨­å®š)");
            }
        }

        function toggleSettings() {
            const p = document.getElementById('settings-panel');
            p.style.display = p.style.display === 'block' ? 'none' : 'block';
        }

        function init() {
            // ç¢ºä¿èªéŸ³åˆ—è¡¨å·²åŠ è¼‰ (Chromeæœ‰æ™‚éœ€è¦ç­‰å¾…)
            if (synth.onvoiceschanged !== undefined) {
                synth.onvoiceschanged = getCantoneseVoice;
            }
            startGame();
        }

        function startGame() {
            currentRound = 0;
            document.getElementById('result-area').style.display = 'none';
            document.getElementById('game-play-area').style.display = 'block';
            nextRound();
        }

        function nextRound() {
            if (currentRound >= totalRounds) {
                showResult();
                return;
            }

            currentRound++;
            updateUI();
            isAnswering = true;
            document.getElementById('feedback-text').innerText = "";

            // 1. é¸é¡Œç›®
            const targetIndex = Math.floor(Math.random() * wordList.length);
            currentTarget = wordList[targetIndex];

            // 2. é¸å¹²æ“¾é … (3å€‹ä¸é‡è¤‡çš„)
            let options = [currentTarget];
            let pool = wordList.filter(w => w !== currentTarget);
            
            while(options.length < 4) {
                const ridx = Math.floor(Math.random() * pool.length);
                options.push(pool[ridx]);
                pool.splice(ridx, 1); // ç§»é™¤é¿å…é‡è¤‡
            }

            // 3. æ‰“äº‚
            options.sort(() => Math.random() - 0.5);

            // 4. æ¸²æŸ“é¸é …
            const grid = document.getElementById('options-area');
            grid.innerHTML = '';
            
            options.forEach(word => {
                const btn = document.createElement('div');
                btn.className = 'word-card';
                btn.innerText = word;
                btn.onclick = () => checkAnswer(word, btn);
                grid.appendChild(btn);
            });

            // 5. è‡ªå‹•æ’­æ”¾é¡Œç›®
            setTimeout(playCurrentQuestion, 500);
        }

        function playCurrentQuestion() {
            speak(currentTarget);
        }

        function checkAnswer(answer, btnElement) {
            if (!isAnswering) return;

            if (answer === currentTarget) {
                // ç­”å°
                isAnswering = false;
                btnElement.className += " correct";
                document.getElementById('feedback-text').innerText = "ç­”å°äº†ï¼";
                document.getElementById('feedback-text').style.color = "#2E7D32";
                speak("å¥½å»ï¼"); // å»£æ±è©±è®šç¾
                setTimeout(nextRound, 1500);
            } else {
                // ç­”éŒ¯
                btnElement.className += " wrong";
                document.getElementById('feedback-text').innerText = "å†è½ä¸€æ¬¡å–”ï¼";
                document.getElementById('feedback-text').style.color = "#C62828";
                speak("è©¦å¤šæ¬¡"); // å»£æ±è©±é‡è©¦
            }
        }

        function updateUI() {
            document.getElementById('score-text').innerText = `${currentRound} / ${totalRounds}`;
            const pct = ((currentRound - 1) / totalRounds) * 100;
            document.getElementById('progress-fill').style.width = `${pct}%`;
        }

        function showResult() {
            document.getElementById('game-play-area').style.display = 'none';
            document.getElementById('result-area').style.display = 'block';
            document.getElementById('progress-fill').style.width = '100%';
            speak("æ­å–œä½ ï¼å®Œæˆæ™’å•¦ï¼");
        }

        // å•Ÿå‹•
        init();

    </script>
</body>
</html>